#!/usr/bin/env bash
set -euo pipefail

REPO="https://git.sr.ht/~emersion/grim"
REF="v1.4.1"
DEST="$HOME/Software/grim"

source "$SRK_ROOT/scripts/utils/utils.sh"
log "Installing Grim ${REF}"
mkdir -p "$(dirname "${DEST}")"
if [ ! -d "$DEST" ]; then
    git clone "$REPO" "$DEST"
fi
(
    cd "$DEST"
    git fetch --all
    git reset --hard >/dev/null
    git clean -dfx
    git checkout "$REF"

    meson setup build
    ninja -C build
)
mkdir -p "$HOME/bin"
rm -rf "$HOME/bin/grim"
ln -s "$DEST/build/grim" "$HOME/bin/grim"
