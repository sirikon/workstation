tasks:
  default:
    labels:
      autorequire: "true"
    requires: [subl-config, smerge-config]

  config:
    abstract: true
    script: |
      rm -rf "$CONFIG_TARGET"
      config_path="$(realpath "$CONFIG")"
      ln -fs "${config_path}" "$CONFIG_TARGET"
    when:
      check_fails: |
        [ "$(readlink "$CONFIG_TARGET")" == "$(realpath "$CONFIG")" ]

  subl-config:
    extends: [config]
    environment:
      CONFIG: "$EBRO_TASK_WORKING_DIRECTORY/../config/sublime-text/Preferences.sublime-settings"
      CONFIG_TARGET: "$HOME/Library/Application Support/Sublime Text/Packages/User/Preferences.sublime-settings"

  smerge-config:
    extends: [config]
    environment:
      CONFIG: "$EBRO_TASK_WORKING_DIRECTORY/../config/sublime-merge/Preferences.sublime-settings"
      CONFIG_TARGET: "$HOME/Library/Application Support/Sublime Merge/Packages/User/Preferences.sublime-settings"
